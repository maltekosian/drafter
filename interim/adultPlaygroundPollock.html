<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <title> new document </title>
  <meta name="generator" content="editplus" />
  <meta name="author" content="" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <style>
  body, canvas{ margin: 0; padding: 0;border: 0;}
  </style>
 </head>

 <body>
  <!--button onclick="startStop();">start|stop</button><br-->
  <canvas onclick="startStop();"></canvas>
  <script>
  //grabbing the canvas with default width and height which is a small rectangle
  var canvas = document.querySelector('canvas');
  //the inner data representation of the canvas
  canvas.width = 800;
  canvas.height = 600;
  //setting up the style. That's the outer visible representation
  canvas.style.width = canvas.width+'px';
  canvas.style.height = canvas.height+'px';
  //fetching a drawable context object of the canvas
  //here it is the 2 dimensional one
  var ctx = canvas.getContext('2d');

  var update = false;

  var currentColor = 'rgba(0,0,0,1)';

  var currentPoint = {x: -1, y: -1};

  var oldPoint = {x: -1, y: -1};

  var lineWidth = 1;

  var initialized = false;

  function startStop() {
    update = !update;
    console.log('update = '+update);
    initialized = false;
    currentPoint.x = Math.random() < 0.5 ? 
                          -1 * Math.round(Math.random() * 100) : 
                          canvas.width + Math.round(Math.random() * 100);
    currentPoint.y = Math.random() < 0.5 ? 
                          -1 * Math.round(Math.random() * 100) : 
                          canvas.height + Math.round(Math.random() * 100);    
  }

  function init() {
    currentPoint.x = Math.random() < 0.5 ? 
                          -1 * Math.round(Math.random() * 100) : 
                          canvas.width + Math.round(Math.random() * 100);
    currentPoint.y = Math.random() < 0.5 ? 
                          -1 * Math.round(Math.random() * 100) : 
                          canvas.height + Math.round(Math.random() * 100);
    oldPoint.x = currentPoint.x;
    oldPoint.y = currentPoint.y;
    lineWidth = 1 + Math.round(Math.random() * 10);
    console.log('init');
    requestAnimationFrame(function() {updateLoop();});
  }
  //todo create the current color with a rgba value setting
  //on each update loop look if the current point is outside the canvas
  //if change the color next point must be in the canvas (x&y>0 && x&y<600)
  //if not create a new random point
  //draw
  //call update loop
  function updateLoop() {
    if (update) {
      if (currentPoint.x < 0 || currentPoint.x > canvas.width ||
          currentPoint.y < 0 || currentPoint.y > canvas.height ) 
      {
        //on each update loop look if the current point is outside the canvas
        oldPoint.x = currentPoint.x;
        oldPoint.y = currentPoint.y;
        while (currentPoint.x < 0 || currentPoint.x > canvas.width ||
               currentPoint.y < 0 || currentPoint.y > canvas.height )
        {
          currentPoint.x = oldPoint.x;
          currentPoint.y = oldPoint.y;
          currentPoint.x += Math.random()<0.5 ? 
                                Math.round(Math.random() * 100) : 
                              -1 * Math.round(Math.random() * 100);
          currentPoint.y += Math.random()<0.5 ? 
                                Math.round(Math.random() * 100) : 
                                -1 * Math.round(Math.random() * 100);
        }
        var r = Math.floor(Math.random() * 256);
        var gb = Math.floor(Math.random() * r);
        var isR = (Math.random() < 0.5);
        currentColor = 'rgba('+ (isR ? r : gb + Math.floor(Math.random() * (256-gb)) ) +
                           ','+ (isR ? r : gb) +
                           ','+ gb +
                           ','+ (!initialized ? 1 : 0.5 + Math.random()*0.5) +')';
        lineWidth = 1 + Math.round(Math.random() * 10);
        //console.log('loop change',oldPoint,currentPoint,currentColor);
      } else {
        //if not create a new random point
        oldPoint.x = currentPoint.x;
        oldPoint.y = currentPoint.y;
        currentPoint.x += Math.random()<0.5 ? Math.round(Math.random() * 100) : -1 * Math.round(Math.random() * 100);
        currentPoint.y += Math.random()<0.5 ? Math.round(Math.random() * 100) : -1 * Math.round(Math.random() * 100);
        //console.log('loop',oldPoint,currentPoint);        
      }
      
      draw();
    }
    requestAnimationFrame(function() {updateLoop();});
  }

  function draw() {
    ctx.fillStyle = currentColor;
    ctx.lineCap = 'round';
    if (!initialized) {      
      ctx.fillRect(0,0,canvas.width,canvas.height);
      //we know in the next loop we will generate a new color and point
      currentPoint.x = -100;
      initialized = true;
    }
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = lineWidth;
    ctx.beginPath();
    ctx.moveTo(oldPoint.x,oldPoint.y);
    if (Math.random() < 0.3) {
      ctx.quadraticCurveTo(oldPoint.x,currentPoint.y, currentPoint.x,currentPoint.y);
      ctx.quadraticCurveTo(currentPoint.x,oldPoint.y, oldPoint.x,oldPoint.y);
    } else if (Math.random() < 0.5) {
      //ctx.lineTo(currentPoint.x,currentPoint.y);
      //ctx.stroke();
      ctx.quadraticCurveTo(oldPoint.x,currentPoint.y, currentPoint.x,currentPoint.y);
      ctx.quadraticCurveTo(currentPoint.x,currentPoint.y, oldPoint.x,oldPoint.y);
    } else {
      ctx.quadraticCurveTo(oldPoint.x,oldPoint.y, currentPoint.x,currentPoint.y);
      ctx.quadraticCurveTo(currentPoint.x,oldPoint.y, oldPoint.x,oldPoint.y);
      
    }
    ctx.fill();
    
    //ctx.stroke();
    if (Math.random() < 0.5) {
      ctx.beginPath();
      ctx.arc(currentPoint.x, currentPoint.y, 
              lineWidth + Math.floor(Math.random()*(Math.random() < 0.3 ? lineWidth*lineWidth : lineWidth)), 
              0, 2 * Math.PI);
      ctx.fill();
    }
  }

  window.onload = function() {
    setTimeout(init, 100);
  };
  </script>
 </body>
</html>
