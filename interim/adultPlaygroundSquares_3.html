<!DOCTYPE html>
<html>
 <head>
  <title> new document </title>
  <meta name="generator" content="editplus" />
  <meta name="author" content="" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <style>
    body { margin: 0; overflow: hidden;}
  </style>
 </head>
 <body>
  <canvas></canvas>
  <script>
    var canvas = document.querySelector('canvas');
    canvas.width = 400;
    canvas.height = 400;    
    var ctx = canvas.getContext('2d');
    var objects = [];
    
    function init() {
      var w = window.innerWidth;
      var h = window.innerHeight;      
      canvas.width = w < h ? w : h;
      canvas.height = w < h ? w : h; 
      canvas.style.width = canvas.width + 'px';
      canvas.style.height = canvas.height + 'px';
      canvas.addEventListener('click', function(eve) {
        var w = window.innerWidth;
        var h = window.innerHeight;
        var w2 = 0;//w < h ? ((w-h)/2) : 0;//if buffered
        var h2 = 0;//w < h ? 0 : ((h-w)/2);//if buffered
        var x = (eve.pageX - w2)/ w;
        var y = (eve.pageY - h2)/ h;
        clicked(x, y);
      },true);      
      objects = generateObjects();
      update = true;
      requestAnimationFrame(function() {updateGraphics();});
    }

    function updateGraphics() {
      if (update) {
        objects = generateObjects();
        drawGraphics();
        objects = generateObjects();
        drawGraphics2(false);
        objects = generateObjects();
        drawGraphics2(false);
        update = false;
      }
      requestAnimationFrame(function() {updateGraphics();});
    }
    
     function draw_Graphics() {
      var cw = canvas.width;
      var ch = canvas.height;
      ctx.beginPath();
      ctx.lineWidth = 1;
      ctx.strokeStyle = '#000';
      ctx.moveTo(0.1*cw, 0);
      ctx.lineTo(0.1*cw, ch);
      ctx.moveTo(0.2*cw, 0);
      ctx.lineTo(0.2*cw, ch);
      ctx.moveTo(0.3*cw, 0);
      ctx.lineTo(0.3*cw, ch);
      ctx.moveTo(0.4*cw, 0);
      ctx.lineTo(0.4*cw, ch);
      ctx.moveTo(0.5*cw, 0);
      ctx.lineTo(0.5*cw, ch);
      //
      ctx.moveTo(0.6*cw, 0);
      ctx.lineTo(0.6*cw, ch);
      ctx.moveTo(0.7*cw, 0);
      ctx.lineTo(0.7*cw, ch);
      ctx.moveTo(0.8*cw, 0);
      ctx.lineTo(0.8*cw, ch);
      ctx.moveTo(0.9*cw, 0);
      ctx.lineTo(0.9*cw, ch);
      ctx.moveTo(cw, 0);
      ctx.lineTo(cw, ch);
      for (var i = 0; i < 1; i += 1/30) {
        ctx.moveTo(i*cw, 0);
        ctx.lineTo(i*cw, ch);
        ctx.moveTo(0, i*ch);
        ctx.lineTo(cw, i*ch);
      }
      ctx.stroke();
    }

    function drawGraphics() {
      var cw = canvas.width;
      var ch = canvas.height;
      var r = Math.floor(Math.random()*6)*51;
      ctx.fillStyle = 'rgb('+r+','+r+','+r+')';
      ctx.fillStyle = '#fff';
      ctx.fillRect(0,0,cw,ch);
      /*for (var i = 0; i < objects.length; i++) {
        ctx.fillStyle = objects[i].color;
        ctx.fillRect(objects[i].x * cw,
                     objects[i].y * ch, 
                     objects[i].w * cw, 
                     objects[i].h * ch);
      }*/
      drawGraphics2(true);
      //draw_Graphics();
      //drawGraphics2(true);
    }

    function drawGraphics2(b) {
      var cw = canvas.width;
      var ch = canvas.height;
      if (b) {
      
      ctx.fillStyle = objects[0].color;
      ctx.lineWidth = cw * 0.06;
      //ctx.fillRect(0,0,cw,ch);
      var wh = 0;
      while (wh < 0.5) {        
        ctx.beginPath();
        ctx.moveTo( wh * cw, wh * ch);
        ctx.lineTo( wh * cw, (1 - wh) * ch);
        ctx.lineTo( (1 - wh) * cw, (1 - wh) * ch);
        ctx.lineTo( (1 - wh) * cw, wh * ch);
        ctx.lineTo( wh * cw, wh * ch);
        //if ((1 - wh - 0.06) > wh + 0.06 )
        {
          ctx.lineTo( (wh + 0.067) * cw, 
                      (wh + 0.067) * ch);
          ctx.lineTo( (1 - wh - 0.067) * cw, 
                      (wh + 0.067) * ch);
          ctx.lineTo( (1 - wh - 0.067) * cw, 
                      (1 - wh - 0.067) * ch);
          ctx.lineTo( (wh + 0.067) * cw, 
                      (1 - wh - 0.067) * ch);
          ctx.lineTo( (wh + 0.067) * cw, 
                      (wh + 0.067) * ch);
        }
        ctx.fill();
          
        wh += 0.1;   
      }
      }
      //
      for (var i = b ? 1 : 0; i < objects.length; i++) {
        wh = 0;//0.03;        
        ctx.fillStyle = objects[i].color;
        while (wh < (objects[i].w * 0.5)) {        
          ctx.beginPath();
          ctx.moveTo( (objects[i].x + wh) * cw, 
                      (objects[i].y + wh) * ch);
          ctx.lineTo( (objects[i].x + wh) * cw, 
                      (objects[i].y + wh + objects[i].h - wh * 2) * ch);
          ctx.lineTo( (objects[i].x + wh + objects[i].w - wh * 2) * cw, 
                      (objects[i].y + wh + objects[i].h - wh * 2) * ch);
          ctx.lineTo( (objects[i].x + wh + objects[i].w - wh * 2) * cw, 
                      (objects[i].y + wh) * ch);
          ctx.lineTo( (objects[i].x + wh) * cw, 
                      (objects[i].y + wh) * ch);
          if ((objects[i].x + wh + 0.067 + objects[i].w - wh * 2 - 0.134) > 
              (objects[i].x + wh + 0.067) )
          {
          ctx.lineTo( (objects[i].x + wh + 0.067) * cw, 
                      (objects[i].y + wh + 0.067) * ch);
          ctx.lineTo( (objects[i].x + wh + 0.067 + objects[i].w - wh * 2 - 0.134) * cw, 
                      (objects[i].y + wh + 0.067) * ch);
          ctx.lineTo( (objects[i].x + wh + 0.067 + objects[i].w - wh * 2 - 0.134) * cw, 
                      (objects[i].y + wh + 0.067 + objects[i].h - wh * 2 - 0.134) * ch);
          ctx.lineTo( (objects[i].x + wh + 0.067) * cw, 
                      (objects[i].y + wh + 0.067 + objects[i].h - wh * 2 - 0.134) * ch);
          ctx.lineTo( (objects[i].x + wh + 0.067) * cw, 
                      (objects[i].y + wh + 0.067) * ch);
          }
          ctx.fill();
          wh = wh + 0.1;  
          console.log(wh);
        }
      }//
    }

    function clicked(x, y) {
      for (var i = 0; i < objects.length; i++) {
        if (objects[i].isDotted(x, y)) {
          //do something(like select, change the color, unselect, set new positon)
        }
      }
      objects = generateObjects();
      update = true;
    }

    function generateObjects() {
      var objects = [];
      var wh = 0;
      var owh = 1;
      for (var i = 0; i < 5; i++) {
        var color = 'rgba('+Math.floor(Math.random()*6)*51+','+
                            Math.floor(Math.random()*6)*51+','+
                            Math.floor(Math.random()*6)*51+','+
                            (0.3+Math.random()*0.5)+')';
        /*var r = Math.floor(Math.random()*6);
        var g = Math.floor(Math.random()*5);
        color = 'rgba('+(51+g*51)+','+
                        (51+g/2*51)+','+
                        r*51+','+
                        (0.3+Math.random()*0.5)+')';*/
        while (wh < 0.05 || wh == owh) {
          wh = Math.floor(Math.random()* 15) * (1/15);
        }
        var x = Math.floor(Math.random()* 15) * (1/15);
        x = (x + wh < 1 && (Math.abs(x - wh) + wh < 1)) ? Math.abs(x - wh) : (1-wh)*x;
        var y = Math.floor(Math.random()* 15) * (1/15);
        y = (y + wh < 1 && (Math.abs(y - wh) + wh < 1)) ? Math.abs(y - wh) : (1-wh)*y;
        var obj = new MyObject('o_'+i, x, y, wh, wh, color);
        objects.push(obj);
        owh = wh;
      }
      objects.sort(function(a, b) {
        return (b.w - a.w);
      });
      console.log('generateObjects()->',objects);
      return objects;
    }

    function MyObject(id, x, y, w, h, color) {
      this.x = x;
      this.y = y;
      this.w = w;
      this.h = h;
      this.id = id;
      this.color = color;

      this.isDotted = function(x, y) {
        return (this.x <= x && this.y <= y && this.x + this.w >= x && this.y + this.h >= y);
      };
    }

    window.onload = function() {
      setTimeout(init, 100);
    };
  </script>
 </body>
</html>
