<!DOCTYPE html>
<html>
 <head>
  <title> new document </title>
  <meta name="generator" content="editplus" />
  <meta name="author" content="" />
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <style>
    body { margin: 0; overflow: hidden;}
  </style>
 </head>
 <body>
  <canvas></canvas>
  <script>
    var canvas = document.querySelector('canvas');
    canvas.width = 400;
    canvas.height = 400;    
    var ctx = canvas.getContext('2d');
    var objects = [];
    
    function init() {
      var w = window.innerWidth;
      var h = window.innerHeight;      
      canvas.width = w < h ? w : h;
      canvas.height = w < h ? w : h; 
      canvas.style.width = canvas.width + 'px';
      canvas.style.height = canvas.height + 'px';
      canvas.addEventListener('click', function(eve) {
        var w = window.innerWidth;
        var h = window.innerHeight;
        var w2 = 0;//w < h ? ((w-h)/2) : 0;//if buffered
        var h2 = 0;//w < h ? 0 : ((h-w)/2);//if buffered
        var x = (eve.pageX - w2)/ w;
        var y = (eve.pageY - h2)/ h;
        clicked(x, y);
      },true);      
      objects = generateObjects();
      update = true;
      requestAnimationFrame(function() {updateGraphics();});
    }

    function updateGraphics() {
      if (update) {
        drawGraphics();
        update = false;
      }
      requestAnimationFrame(function() {updateGraphics();});
    }

    function drawGraphics() {
      var cw = canvas.width;
      var ch = canvas.height;
      ctx.fillStyle = objects[0].color;
      ctx.fillRect(0,0,cw,ch);
      for (var i = 1; i < objects.length; i++) {
        ctx.fillStyle = objects[i].color;
        ctx.fillRect(objects[i].x * cw,
                     objects[i].y * ch, 
                     objects[i].w * cw, 
                     objects[i].h * ch);
      }
    }

    function clicked(x, y) {
      for (var i = 0; i < objects.length; i++) {
        if (objects[i].isDotted(x, y)) {
          //do something(like select, change the color, unselect, set new positon)
        }
      }
      update = true;
    }

    function generateObjects() {
      var objects = [];
      var wh = 0;
      var owh = 1;
      for (var i = 0; i < 5; i++) {
        var color = 'rgba('+Math.floor(Math.random()*6)*51+','+
                            Math.floor(Math.random()*6)*51+','+
                            Math.floor(Math.random()*6)*51+','+
                            (0.45+Math.random()*0.45)+')';
        while (wh < 0.05 || wh == owh) {
          wh = Math.random();
        }
        var x = Math.random();
        x = (x + wh < 1 && (Math.abs(x - wh) + wh < 1)) ? Math.abs(x - wh) : (1-wh)*x;
        var y = Math.random();
        y = (y + wh < 1 && (Math.abs(y - wh) + wh < 1)) ? Math.abs(y - wh) : (1-wh)*y;
        var obj = new MyObject('o_'+i, x, y, wh, wh, color);
        objects.push(obj);
        owh = wh;
      }
      objects.sort(function(a, b) {
        return (b.w - a.w);
      });
      console.log('generateObjects()->',objects);
      return objects;
    }

    function MyObject(id, x, y, w, h, color) {
      this.x = x;
      this.y = y;
      this.w = w;
      this.h = h;
      this.id = id;
      this.color = color;

      this.isDotted = function(x, y) {
        return (this.x <= x && this.y <= y && this.x + this.w >= x && this.y + this.h >= y);
      };
    }

    window.onload = function() {
      setTimeout(init, 100);
    };
  </script>
 </body>
</html>
