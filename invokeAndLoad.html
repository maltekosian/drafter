<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlusÂ®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>Document</title>
  <script>
  var json = JSON.stringify( 
  {van:{INSTANCE:"Car",car:"yes",cars:["auto","van","monstrum",true],value:1},vans:[1,2,3,4,5,6],value:2,other:{count:4},erm:33} );
  console.log(json);

  window.onload = function() {setTimeout(init, 100);};

  function Car() {
	this.load = function(obj, data) {
	  for (key in data)
	  {
		//console.log(data[key]);
		var datastr = ((data[key]).constructor).toString().toLowerCase();//(Object.prototype.toString.call(data[key])).toLowerCase();
		datastr = datastr.substr(9);
		datastr = datastr.substr(0, datastr.indexOf('('));
		
		if (datastr === 'object')
		{
			//must be an object/function
			//create new instance of object if possible
			console.log(key+'=>'+datastr);
			obj[key] = {};
			this.load(obj[key], data[key]);
		} else if (datastr === 'array')
		{
			console.log(key+'->'+datastr);
			obj[key] = [];
			this.load(obj[key], data[key]);
		} else
		{
			obj[key] = data[key];
			console.log(key+' '+data[key]+' '+datastr);
			//a normal value
		}
	  }
	};
  }
  
  function init () {
	var data = JSON.parse(json);
	var obj = parseData ({}, data);
  }

  /*function invokeFunctionByName(functionName, context //, args 
									) {
	  var args = [].slice.call(arguments).splice(2);
	  var namespaces = functionName.split(".");
	  var func = namespaces.pop();
	  for(var i = 0; i < namespaces.length; i++) {
		context = context[namespaces[i]];
	  }
	  return new (context[func].apply(this, args));
	};*/

  function parseData (data)	{
	for (key in data)
	{
		//console.log(data[key]);
		var datastr = ((data[key]).constructor).toString().toLowerCase();//(Object.prototype.toString.call(data[key])).toLowerCase();
		datastr = datastr.substr(9);
		datastr = datastr.substr(0, datastr.indexOf('('));
		
		if (datastr === 'object')
		{
			//must be an object/function
			//create new instance of object if possible
			if (typeof data[key]['INSTANCE'] != 'undefined' && data[key]['INSTANCE'] != null)
			{
				var tmp_func = new Function('return new '+data[key]['INSTANCE']+'();');
				//console.log( obj );
				var obj = tmp_func();
				//instead of invokeFunctionByName(data[key]['INSTANCE'], window);
				obj.load(obj,data[key]);
				console.log( obj );
			} else {
			console.log(key+'=>'+datastr);
			parseData (data[key]);
			}
		} else if (datastr === 'array')
		{
			console.log(key+'->'+datastr);
			parseData (data[key]);
		} else
		{
			console.log(key+' '+data[key]+' '+datastr);
			//a normal value
		}
		
	}
  };
  </script>
 </head>
 <body>
  
 </body>
</html>
